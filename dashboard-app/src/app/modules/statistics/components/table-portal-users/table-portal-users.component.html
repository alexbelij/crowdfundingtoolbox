<div class="container">
    <div class="row">
        <div class="col">
            <h2>{{title}}
                <ng-container *ngIf="enablePortalUsersCount && !loading">({{portalUsersCount}})</ng-container>
            </h2>
        </div>
        <ng-container *ngIf="showDates">
            <div class="col-3 d-flex align-items-center">
                from:
                <app-datepicker
                    [(date)]="from"
                    [maxDate]="to"
                    [type]="'start'"
                    [disabled]="true">
                </app-datepicker>
            </div>
            <div class="col-3 d-flex align-items-center">
                to:
                <app-datepicker
                    [(date)]="to"
                    [minDate]="from"
                    [type]="'end'"
                    [disabled]="true">
                </app-datepicker>
            </div>
        </ng-container>
        <div class="col-3 d-flex align-items-center">
            <ngx-select-dropdown [(ngModel)]="model.columns"
                                 [multiple]="true" [config]="config"
                                 [options]="availableColumns"></ngx-select-dropdown>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <table class="list-items list-items--orderable">
                <thead>
                <tr>
                    <th app-table-header class="id" *ngIf="activeColumn('order')"
                        [column]="getColumnByValueName('order')"
                        [(model)]="model" (modelChange)="sortTable()">#
                    </th>
                    <th app-table-header *ngIf="activeColumn('status')" [column]="getColumnByValueName('status')"
                        [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('user.email')"
                        [column]="getColumnByValueName('user.email')"
                        [(model)]="model" (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('user.user_detail.last_name')"
                        [column]="getColumnByValueName('user.user_detail.last_name')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('amount_sum')"
                        [column]="getColumnByValueName('amount_sum')"
                        [(model)]="model" (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('todo1')" [column]="getColumnByValueName('todo1')"
                        [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('user.user_detail.created_at')"
                        [column]="getColumnByValueName('user.user_detail.created_at')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('last_donation_at')"
                        [column]="getColumnByValueName('last_donation_at')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('user.updated_at')"
                        [column]="getColumnByValueName('user.updated_at')"
                        [(model)]="model" (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('campaign_name')"
                        [column]="getColumnByValueName('campaign_name')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('user.id')" [column]="getColumnByValueName('user.id')"
                        [(model)]="model" (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('variable_symbol.variable_symbol')"
                        [column]="getColumnByValueName('variable_symbol.variable_symbol')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('todo6')" [column]="getColumnByValueName('todo6')"
                        [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('is_monthly_donor')"
                        [column]="getColumnByValueName('is_monthly_donor')" [(model)]="model"
                        (modelChange)="sortTable()"></th>
                    <th app-table-header *ngIf="activeColumn('todo8')" [column]="getColumnByValueName('todo8')"
                        [(model)]="model"
                        (modelChange)="sortTable()"></th>

                </tr>
                </thead>
                <tbody *ngIf="!loading">
                <tr *ngFor="let portalUser of sortedPortalUsers; let i = index" class="list-items--item">
                    <td *ngIf="activeColumn('order')">{{i+1}}</td>
                    <td *ngIf="activeColumn('status')">
                        <app-donor-status [isMonthlyDonor]="portalUser.last_donation_at!=null"></app-donor-status>
                    </td>
                    <td *ngIf="activeColumn('user.email')">
                        {{portalUser.user.email}}
                    </td>
                    <td *ngIf="activeColumn('user.user_detail.last_name')" class="pointer"
                        [routerLink]="['/'+ routing.PORTAL_USERS_FULL_PATH, portalUser.user.id]">
                        {{portalUser.user.user_detail?.first_name}} {{portalUser.user.user_detail?.last_name}}
                    </td>
                    <td *ngIf="activeColumn('amount_sum')">
                        {{portalUser.amount_sum | currency: 'EUR': 'symbol': '1.0-2' :'sk'}}
                    </td>
                    <td *ngIf="activeColumn('todo1')">
                        todo
                    </td>
                    <td [title]="portalUser.user.user_detail.created_at | date:'dd.MM.yyyy HH:mm:ss'"
                        *ngIf="activeColumn('user.user_detail.created_at')">
                        {{portalUser.user.user_detail.created_at | date:'dd.MM.yyyy'}}
                    </td>
                    <td [title]="portalUser.last_donation_at | date:'dd.MM.yyyy HH:mm:ss'"
                        *ngIf="activeColumn('last_donation_at')">
                        {{portalUser.last_donation_at | date:'dd.MM.yyyy'}}
                    </td>
                    <td [title]="portalUser.user.updated_at | date:'dd.MM.yyyy HH:mm:ss'"
                        *ngIf="activeColumn('user.updated_at')">
                        {{portalUser.user.updated_at | date:'dd.MM.yyyy'}}
                    </td>
                    <td *ngIf="activeColumn('campaign_name')">
                        {{portalUser.campaign_name}}
                    </td>
                    <td *ngIf="activeColumn('user.id')">
                        {{portalUser.user.user_detail.id}}
                    </td>
                    <td *ngIf="activeColumn('variable_symbol.variable_symbol')">
                        {{portalUser.variable_symbol.variable_symbol}}
                    </td>
                    <td *ngIf="activeColumn('todo6')">
                        todo6
                    </td>
                    <td *ngIf="activeColumn('is_monthly_donor')">
                        {{portalUser.is_monthly_donor | monthly}}
                    </td>
                    <td *ngIf="activeColumn('todo8')">
                        todo8
                    </td>
                </tr>
                </tbody>
            </table>

            <h4 *ngIf="!loading && sortedPortalUsers.length===0"
                class="text-center"> No users found </h4>
            <app-loading [isLoading]="loading"></app-loading>

            <div *ngIf="!loading && limit < portalUsersCount" class="container">
                <div class="row">
                    <div class="col">
                        <span class="clickable" (click)="showMore()">show more</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>